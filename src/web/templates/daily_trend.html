<script>
    const trendUrl = "/api/v1/{{ env }}/account/{{ account }}/trend?start_from=2170"
    const trendData = async () => {
        const response = await fetch(trendUrl);
        const json = await response.json();
        const data = json.data
        const dates = data.map(obj => obj.date)
        const pos = data.map(obj => obj.pl)
        return {
            dates,
            pos
        }
    }

    async function printTrendChart() {
        let {dates, pos} = await trendData()
        BuildChart(dates, pos, 'trend', 'dailyTrend')
    }

    printTrendChart()

    function numberWithCommas(x) {
        let parts = x.toString().split(".");
        parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        return parts.join(".");
    }

    const statsUrl = "/api/v1/{{env}}/account/{{account}}/stats?start_from={{ start_from }}"
    fetch(url).then(function (response) {
        response.json().then(function (payload) {
            nav.textContent = '£' + numberWithCommas(payload.data.nav.toFixed(0))
            npl.textContent = '£' + numberWithCommas(payload.data.pl.toFixed(0))
            noTrades.textContent = numberWithCommas(payload.data.no_of_trades.toFixed(0))
            $('.dial').val(payload.data.win_percent * 100).trigger('change')
        });
    });
</script>
<div class="row">
    <div class="col-xl-3" style="margin-left: auto; margin-right: auto;">
        <div class="card-header">
            <i class="fas fa-chart-pie mr-1"></i>
            Win Loss Ratio%
        </div>
        <div class="card-body" style="margin-left: auto; margin-right: auto;">
            <label>
                <input type="text" id="wlRatio" value="0" class="dial animated" data-fgColor="#35AE74">
            </label>
            <script>
                $(function () {
                    $(".dial").knob({
                        'format': function (value) {
                            return value + '%';
                        },
                        'draw': function () {
                            $(this.i).css('font-size', '24pt');
                        }
                    });

                });
            </script>
        </div>

    </div>
    <div class="col-xl-9">
        <div class="card-header">
            <i class="fas fa-chart-bar mr-1"></i>
            Daily Trend
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-sm-9 my-auto">
                    <canvas id="dailyTrend" width="100" height="50"></canvas>
                </div>
                <div class="col-sm-3 text-center my-auto">
                    <div class="h4 mb-0 text-primary" id="nav">£0</div>
                    <div class="small text-muted">Net Asset Value</div>
                    <hr>
                    <div class="h4 mb-0 text-danger" id="npl">£0</div>
                    <div class="small text-muted">Net PL</div>
                    <hr>
                    <div class="h4 mb-0 text-warning" id="noTrades">0</div>
                    <div class="small text-muted">No of Trades</div>
                </div>
            </div>
        </div>
    </div>

</div>